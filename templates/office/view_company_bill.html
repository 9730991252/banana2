{% extends 'home/base.html' %}
{% block head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js" integrity="sha512-pdCVFUWsxl1A4g0uV6fyJ3nrnTGeWnZN2Tl/56j45UvZ1OMdm9CIbctuIHj+yBIRTUUyv6I9+OivXj4i0LPEYA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
{% endblock head %}
{% block content %}
{% include 'include/alert.html' %}
{% load static %}
<div class="hide">


    <div>
        welcome - {{e.name}}
    </div>
    {% include 'include/office/office_menu.html' %}
</div>
<style media="print">
    .hide{
        display: none;
    }
</style>
<style>
    *{
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    .main_box{

        margin:  0 auto;
        text-align: center;
        color: black;
        div{
            z-index: 1321231;
        }
    }
    .shope_name{
        text-transform: uppercase;
        z-index: 1;
        color: rgb(255, 0, 0);
        font-size: 30px;
        font-weight: 700;

    }
    .address{
        font-weight: 500;
        margin: 0 auto;
        font-size: 25px;
    }

    .flex{
        display: flex;
        justify-content: center;
    }
    .vehicale_number{
        text-transform: uppercase;
    }
    .contact_details{
        line-height: 0px;
        font-size: 20px;
        padding-bottom: 20px;
        border-bottom: 2px solid black;
    }
    .containt_box{
        font-size: 20px;
        position: relative;
        display: grid;
        grid-template-columns: 2fr 1fr;
        border-top: 1px solid black;
        background-image: url("{% static 'img/new_banana.jpg' %}");
        background-repeat: no-repeat;
        background-position: center;
        background-size: 400px;


        div{
            z-index: 321321;
        }

        .div1{
            display: flex;
            align-items: center;
            border-bottom: 1px solid black;
            border-left: 1px solid black;
            border-right: 1px solid black;
            text-align: start;
            padding-left: 10px;
            height: 40px;
        }
        .div2{
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid black;
            border-right: 1px solid black;
            height: 40px;
            font-weight: 700;
        }
        .detail{
            grid-column-start: 1;
            grid-column-end: 3;
            grid-row-start: 1;
            grid-row-end: 1;
            text-align: center;
        }
        img{
            position: absolute;
            opacity: 0.5;
            width: 400px;
            z-index: -533;
        }
    }
    #total_amount_words{
        text-transform: uppercase;
        font-weight: 700;
        font-size: 15px;
        padding: 5px;

    }
    .logo_img{
        background-color: aqua;
        width: 100px;
        height: 100px;
        img{
            width: 100%;
            height: 100%;
        }
    }
    </style>
    
    <div>
        
<div class="container">
        <div class="text-center hide">
            <button class="btn btn-warning" onclick="createPDF()">download pdf</button>
        </div>



        
        <div class="main_box" id="canvas">

            <div class="" style="position: relative;" >
                <div class="logo_img" id="logo_img" style="position: absolute;left: 0;top: 0; display: none;"><img src="{{logo.image.url}}" alt=""></div>
                <div class="shope_name " >{{e.shope.shope_name}}</div>
            </div>
        <div class="address"><p>{{e.shope.address}}</p></div>
        <div class="contact_details"><b>{{e.shope.contact_details}}</b></div>
        <div class="flex p-2 " style="justify-content: space-between;">
            <div>बिल नं. <b>{{bill.bill_number}}</b></div>
            <div>{{bill.added_date}}</div>
            <div class="vehicale_number">गाडी नंबर  {{bill.vehicale_number}}</div>
        </div>
        <div class="flex p-2" style="font-size: 20px; line-height: 0px; justify-content: space-between;">
            <div>कंपनी नाव &nbsp; <b> {{bill.company.name}}</b></div>
        </div>
        <div class="mb-3">{{bill.farmer.address}}</div>
        
        <div class="containt_box">
            
            <div class="div1 detail">तपशील</div>
            
            <div class="div1" id="total_vehicale_weight1">गाडीचे एकुण वजन</div>
            <div class="div2" id="total_vehicale_weight2">{{bill.total_vehicale_weight}}</div>
            
            <div class="div1" id="empty_vehicale_weight1">रिकाम्या गाडीचे वजन</div>
            <div class="div2" id="empty_vehicale_weight2">{{bill.empty_vehicale_weight}}</div>
            
            <div class="div1" >मालाचे वजन </div>
            <div class="div2" >{{bill.weight}}</div>
            
            <div class="div1" id="empty_box1">मोकळे बॉक्स वजा </div>
            <div class="div2" id="empty_box2">{{bill.empty_box}}</div>
            
            <div class="div1" id="empty_box_weight1">मालाचे वजन </div>
            <div class="div2" id="empty_box_weight2">{{empty_box_weight}}</div>
            
            <div class="div1" id="wasteage1">वेस्टेज </div>
            <div class="div2" id="wasteage2">{{bill.wasteage}}</div>
            
            <div class="div1">मालाचे वजन </div>
            <div class="div2">{{wasteage_weight}}</div>
            
            <div class="div1" id="danda_weight1">दांडा वजन </div>
            <div class="div2" id="danda_weight2">{{danda_weight}}</div>
            
            <div class="div1">एकुण मालाचे वजन </div>
            <div class="div2">{{total_weight}}</div>
            
            <div class="div1">दर </div>
            <div style="font-weight: 700; color: red;" class="div2">{{bill.prise}}</div>
            
            <div class="div1">रक्कम </div>
            <div class="div2">{{amount}}</div>
            
            <div class="div1" id="service_charge1">सर्व्हिस चार्ज रक्कम</div>
            <div class="div2" id="service_charge2">{{bill.service_charge}}</div>
            
            <div id="labor_amount1" class="div1">लेबर वजा </div>
            <div id="labor_amount2" style="font-weight: 700; color: red;"  class="div2">{{bill.labor_amount}}</div>
            
            <div id="eater1" class="div1">इतर चार्ज</div>
            <div id="eater2" style="font-weight: 700; color: red;"  class="div2">{{bill.eater}}</div>
            
            <div style="font-weight: 700;background-color: rgb(212, 249, 255);" class="div1 mb-3">एकुण रक्कम </div>
            <div style="font-weight: 700;background-color: rgb(212, 249, 255);" id="total_amount" class="div2 mb-3">{{bill.total_amount}}</div>
        </div>

        <div id="total_amount_words">{{total_amount_words}}</div>
        <div style="width: fit-content;margin-right: auto;">
            <div class="text-center">
                <div><img style="width: 100px;" src="{{signature.image.url}}" alt=" "></div>
                <div>{{e.shope.shope_name}}</div>
            </div>
        </div>

        <div class="text-center mt-3">
            <h6><a href="https://bookkaryalay.com/contact_us/" style="text-decoration: none;color: black;">सर्व प्रकारचे बारकोड व बिलिंग सॉफ्टवेअर तयार करून मिळतील &nbsp; PRASANNA DIGITAL - 9730991252</a></h6>
        </div>
        </div>

    

    </div>
    
    <br>
    
</div>

<div class="container">
<!------------------------------------ -------------------------------------------->
<div id="pending_box" class="mb-3 mt-2 border p-3 text-center flex" style="width: 280px;gap: 20px;margin-left: 50px;" >
    <label for="cash">बाकी </label>
    <input type="text" {% if total_pending_amount != 0.0 %} style="width: 200px; text-align: center;font-weight: 700;color: white; background-color: red;" {% else %} style="text-align: center;font-weight: 700;color: rgb(0, 0, 0); background-color: rgb(81, 255, 0);"{% endif %} class="form-control" value="{{total_pending_amount | floatformat:2}}"  id="total_pending_amount" readonly>
</div>

<div class="mb-3 mt-2 border p-3 text-center" style="background-color: rgb(192, 250, 192);">
    <form method="POST">
        <div class="" style="display: flex;gap: 10px;">
        <label for="cash">रोख</label>
        <input type="text" class="form-control" style="background-color: rgb(182, 255, 182);" value="मिळालेली रक्कम - {{cash_amount}}" disabled >
        <input  placeholder="रक्कम टाका" type="number" class="form-control" name="cash_amount"  id="cash_amount" oninput="check_cash_amount('{{total_pending_amount}}')">
        <div id="cash_btn" style="display: none;"><button class="btn btn-success" name="save_cash_amount"><i class="fa-solid fa-check"></i></button></div>
    </div>
    </form>
</div>


<form method="POST">
    <div class="mb-3 mt-2 border p-3 text-center" style="background-color: hsl(236, 100%, 80%);">
        <div class="" style="display: flex;gap: 10px;">
            <label for="cash">Phonepe</label>
            <input type="text" class="form-control" style="background-color: rgb(182, 255, 182);" value="मिळालेली रक्कम - {{phonepe_amount}}" disabled >
        </div>
        <div class="" style="display: flex;gap: 10px;margin-top: 10px;">
            <input type="number" name="mobile" placeholder="Phonepe Mobile" class="form-control" required>
            <input placeholder="रक्कम टाका" style="width: 46%;" type="number" class="form-control" name="amount" id="phonepe_amount{{p.id}}" oninput="check_phonepe_amount('phonepe_amount{{p.id}}', 'phonepe_btn{{p.id}}', '{{total_pending_amount}}')">
            <div id="phonepe_btn{{p.id}}" style="display: none;" ><button name="save_phonepe_amount" class="btn btn-success"><i class="fa-solid fa-check"></i></button></div>
        </div>
    </div>
    </form>
    
    <form method="POST">
    <div class="mb-3 mt-2 border p-3 text-center" style="background-color: hsl(32, 100%, 80%);">
        <div class="" style="display: flex;gap: 10px;">
            <label for="Bank">Bank</label>
            <input type="text" class="form-control" style="background-color: rgb(182, 255, 182);" value="मिळालेली रक्कम - {{bank_amount}}" disabled >
        </div>
        <div class="" style="display: flex;gap: 10px;margin-top: 10px;">
            <input type="number" name="bank_number" placeholder="Bank Number" class="form-control" required>
            <input placeholder="रक्कम टाका" style="width: 46%;"  type="number" class="form-control" name="amount" id="bank_amount{{b.id}}" oninput="check_bank_amount('bank_amount{{b.id}}', 'bank_btn{{b.id}}', '{{total_pending_amount}}')">
            <div id="bank_btn{{b.id}}" style="display: none;" ><button name="save_bank_amount" class="btn btn-success"><i class="fa-solid fa-check"></i></button></div>
        </div>
    </div>
    </form>
    
    
    <div class=" text-center p-3 border" id="transition_histry" style="display: grid;grid-template-columns: 2fr 1fr;">
        {% for c in cash %}
            <div>Cash - {{c.added_date}}</div>
            <div><b>Rs.{{c.amount}}</b></div>
        {% endfor %}
        {% for p in phonepe_transition %}
            <div>{{p.mobile}} - {{p.added_date}}</div>
            <div><b>Rs.{{p.amount}}</b></div>
        {% endfor %}
        {% for b in bank_transition %}
            <div>{{b.bank_number}} - {{b.added_date}}</div>
            <div><b>Rs.{{b.amount}}</b></div>
        {% endfor %}
        <div style="background-color: rgb(194, 255, 255); border-radius: 5px;">Total</div>
        <div style="background-color: rgb(0, 255, 255); border-radius: 5px;"><b>Rs.{{total_credit}}</b></div>
    </div>
    </div>
    <br><br><br>

</div>
<script>
        function check_bank_amount(input_id, btn_id,pending_amount){
        input = document.getElementById(input_id).value
        if(Number(input) > 0){
            document.getElementById(btn_id).style.display = 'unset'
        }
        if(Number(input) < 1){
            document.getElementById(btn_id).style.display = 'none'
        }
        if(Number(input) > Number(pending_amount)){
            document.getElementById(btn_id).style.display = 'none'
            input = document.getElementById(input_id).value = ''
        }
        if(Number(input) < 0){
            document.getElementById(btn_id).style.display = 'none'
            input = document.getElementById(input_id).value = ''
        }
    }
    function check_phonepe_amount(input_id, btn_id,pending_amount){
        input = document.getElementById(input_id).value
        if(Number(input) > 0){
            document.getElementById(btn_id).style.display = 'unset'
        }
        if(Number(input) < 1){
            document.getElementById(btn_id).style.display = 'none'
        }
        if(Number(input) > Number(pending_amount)){
            document.getElementById(btn_id).style.display = 'none'
            input = document.getElementById(input_id).value = ''
        }
        if(Number(input) < 0){
            document.getElementById(btn_id).style.display = 'none'
            input = document.getElementById(input_id).value = ''
        }
    }

function check_cash_amount(pending_amount){
        input = document.getElementById('cash_amount').value
        if(Number(input) > 0){
            document.getElementById('cash_btn').style.display = 'unset'
        }
        if(Number(input) < 1){
            document.getElementById('cash_btn').style.display = 'none'
        }
        if(Number(input) > Number(pending_amount)){
            document.getElementById('cash_btn').style.display = 'none'
            input = document.getElementById('cash_amount').value = ''
        }
        if(Number(input) < 0){
            document.getElementById('cash_btn').style.display = 'none'
            input = document.getElementById('cash_amount').value = ''
        }

    }

/////////////////////////////////////////////////////////////////////

function createPDF() {
    total_vehicale_weight2 = document.getElementById('total_vehicale_weight2').innerText;
    if(Number(total_vehicale_weight2) == 0){
        document.getElementById('total_vehicale_weight1').style.display = 'none'
        document.getElementById('total_vehicale_weight2').style.display = 'none'
    }
    empty_vehicale_weight2 = document.getElementById('empty_vehicale_weight2').innerText;
    if(Number(empty_vehicale_weight2) == 0){
        document.getElementById('empty_vehicale_weight1').style.display = 'none'
        document.getElementById('empty_vehicale_weight2').style.display = 'none'
    }
    empty_box2 = document.getElementById('empty_box2').innerText;
    if(Number(empty_box2) == 0){
        document.getElementById('empty_box1').style.display = 'none'
        document.getElementById('empty_box2').style.display = 'none'
        document.getElementById('empty_box_weight1').style.display = 'none'
        document.getElementById('empty_box_weight2').style.display = 'none'
    }
    wasteage2 = document.getElementById('wasteage2').innerText;
    if(Number(wasteage2) == 0){
        document.getElementById('wasteage1').style.display = 'none'
        document.getElementById('wasteage2').style.display = 'none'
    }
    danda_weight2 = document.getElementById('danda_weight2').innerText;
    if(Number(danda_weight2) == 0){
        document.getElementById('danda_weight1').style.display = 'none'
        document.getElementById('danda_weight2').style.display = 'none'
    }
    service_charge2 = document.getElementById('service_charge2').innerText;
    if(Number(service_charge2) == 0){
        document.getElementById('service_charge1').style.display = 'none'
        document.getElementById('service_charge2').style.display = 'none'
    }
    labor_amount2 = document.getElementById('labor_amount2').innerText;
    if(Number(labor_amount2) == 0){
        document.getElementById('labor_amount1').style.display = 'none'
        document.getElementById('labor_amount2').style.display = 'none'
    }
    eater2 = document.getElementById('eater2').innerText;
    if(Number(eater2) == 0){
        document.getElementById('eater1').style.display = 'none'
        document.getElementById('eater2').style.display = 'none'
    }

document.getElementById('logo_img').style.display = 'unset'

    //////////////

    var pdf = document.getElementById("canvas");
    var opt = {
        margin: 0.5,
        filename: '{{bill.farmer.name}} '+ new Date().toLocaleString() +' .pdf',
        image: { type: 'jpeg', quality: 50 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'a4', orientaion: 'portrait' }
    };
    html2pdf().set(opt).from(pdf).save().then(pdfResult => {

    //////////////
    document.getElementById('logo_img').style.display = 'none'

    total_vehicale_weight2 = document.getElementById('total_vehicale_weight2').innerText;
    if(Number(total_vehicale_weight2) == 0){
        document.getElementById('total_vehicale_weight1').style.display = 'unset'
        document.getElementById('total_vehicale_weight2').style.display = 'unset'
    }

    empty_vehicale_weight2 = document.getElementById('empty_vehicale_weight2').innerText;
    if(Number(empty_vehicale_weight2) == 0){
        document.getElementById('empty_vehicale_weight1').style.display = 'unset'
        document.getElementById('empty_vehicale_weight2').style.display = 'unset'
    }
    empty_box2 = document.getElementById('empty_box2').innerText;
    if(Number(empty_box2) == 0){
        document.getElementById('empty_box1').style.display = 'unset'
        document.getElementById('empty_box2').style.display = 'unset'
        document.getElementById('empty_box_weight1').style.display = 'unset'
        document.getElementById('empty_box_weight2').style.display = 'unset'
    }
    wasteage2 = document.getElementById('wasteage2').innerText;
    if(Number(wasteage2) == 0){
        document.getElementById('wasteage1').style.display = 'unset'
        document.getElementById('wasteage2').style.display = 'unset'
    }
    danda_weight2 = document.getElementById('danda_weight2').innerText;
    if(Number(danda_weight2) == 0){
        document.getElementById('danda_weight1').style.display = 'unset'
        document.getElementById('danda_weight2').style.display = 'unset'
    }
    service_charge2 = document.getElementById('service_charge2').innerText;
    if(Number(service_charge2) == 0){
        document.getElementById('service_charge1').style.display = 'unset'
        document.getElementById('service_charge2').style.display = 'unset'
    }
    labor_amount2 = document.getElementById('labor_amount2').innerText;
    if(Number(labor_amount2) == 0){
        document.getElementById('labor_amount1').style.display = 'unset'
        document.getElementById('labor_amount2').style.display = 'unset'
    }
    eater2 = document.getElementById('eater2').innerText;
    if(Number(eater2) == 0){
        document.getElementById('eater1').style.display = 'unset'
        document.getElementById('eater2').style.display = 'unset'
    }
});
}

</script>
{% endblock content %}